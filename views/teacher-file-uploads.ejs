<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload File</title>

    <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/dazsma-logo.ico" />
    <link href="/assets/libs/flot/css/float-chart.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="/assets/extra-libs/multicheck/multicheck.css" />
    <link href="/assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.css" rel="stylesheet" />
    <link href="/dist/css/style.min.css" rel="stylesheet" />

<!-- Bootstrap JS (optional, if you need modal functionality) -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/data.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        /* Modal styles */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgb(0,0,0); /* Fallback color */
            background-color: rgba(0,0,0,0.9); /* Black w/ opacity */
        }
    
    /* Modal Content/Box */
    .modal-content {
        background-color: #fefefe;
        margin: 5% auto; /* 5% from the top and centered */
        padding: 20px;
        border: 1px solid #888;
        width: 90%; /* 90% of the screen width */
        max-width: 950px; /* Limit maximum width */
        height: 90%; /* 90% of the screen height */
        max-height: 90%; /* Limit maximum height */
        overflow-y: auto; /* Enable vertical scroll if needed */
    }

    /* Adjust iframe size for PDF */
    .modal-content iframe {
        width: 100%; /* Occupy full width */
        height: 100%; /* Occupy full height */
    }
    
        /* Close button */
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
    
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>

</head>
<% if (teacherid) { %>

    <body>

      <% if (messages.success) { %>
                        
        <script>
            Swal.fire({
                icon: 'success',
                title: 'File Uploaded Successfully',
                text: '<%= messages.success %>',
            });
        </script>
    
      <% } %>
      <% if (messages.success1) { %>

        <script>
            Swal.fire({
                icon: 'success',
                title: 'File Updated Successfully',
                text: '<%= messages.success1 %>',
            });
        </script>
      <% } %>

      <div class="preloader">
        <div class="lds-ripple">
          <div class="lds-pos"></div>
          <div class="lds-pos"></div>
        </div>
      </div>
      <div id="main-wrapper" data-layout="vertical" data-navbarbg="skin5" data-sidebartype="full"
        data-sidebar-position="absolute" data-header-position="absolute" data-boxed-layout="full">
        <header class="topbar" data-navbarbg="skin5">
          <nav class="navbar top-navbar navbar-expand-md navbar-dark">
            <div class="navbar-header" data-logobg="skin5">
              <a class="navbar-brand" href="/teacher/dashboard">
                <b class="logo-icon ps-2">
                  <img src="../assets/images/dazsma-logo.png" alt="homepage" class="light-logo" width="25" />
                </b>
                <span class="logo-text ms-2">
                  <span>DAZSMA</span>
                </span>
              </a>
              <a class="nav-toggler waves-effect waves-dark d-block d-md-none" href="javascript:void(0)"><i
                  class="ti-menu ti-close"></i></a>
            </div>
            <div class="navbar-collapse collapse" id="navbarSupportedContent" data-navbarbg="skin5">
              <ul class="navbar-nav float-start me-auto">
                <li class="nav-item d-none d-lg-block">
                  <a class="nav-link sidebartoggler waves-effect waves-light" href="javascript:void(0)"
                    data-sidebartype="mini-sidebar"><i class="mdi mdi-menu font-24"></i></a>
                </li>
              </ul>
            </div>
          </nav>
        </header>
      
        <aside class="left-sidebar" data-sidebarbg="skin5">
          <div class="scroll-sidebar">
            <nav class="sidebar-nav">
              <ul id="sidebarnav" class="pt-4">
                <li class="sidebar-item">
                  <a class="sidebar-link waves-effect waves-dark sidebar-link" href="/teacher/dashboard"
                    aria-expanded="false"><i class="mdi mdi-view-dashboard"></i><span
                      class="hide-menu">Dashboard</span></a>
                </li>
                <li class="sidebar-item">
                  <a href="/file_uploads" class="sidebar-link waves-effect waves-dark sidebar-link" style="margin-top: auto;"
                    aria-expanded="false"><i class="mdi mdi-folder"></i><span class="hide-menu">Files</span></a>
                </li>
                <li class="sidebar-item">
                  <a href="/teacher/account" class="sidebar-link waves-effect waves-dark sidebar-link" style="margin-top: auto;"
                    aria-expanded="false"><i class="mdi mdi-account"></i><span class="hide-menu">Account</span></a>
                </li>
  
                <% if (teacherid) { %>
                  <div class="logout-button-container">
                    <form id="logoutForm" action="/teacher-logout" method="post">
                      <li class="sidebar-item">
                        <a href="javascript:void(0);" class="sidebar-link waves-effect waves-dark sidebar-link"
                          onclick="document.getElementById('logoutForm').submit();" aria-expanded="false"><i
                            class="mdi mdi-logout"></i><span class="hide-menu">Logout</span></a>
                      </li>
                    </form>
                  </div>
                    <% } else { %>
                      <div class="logout-button-container">
                      <li class="sidebar-item">
                        <a href="/teacher" class="sidebar-link waves-effect waves-dark sidebar-link"
                          aria-expanded="false"><i class="mdi mdi-login"></i><span class="hide-menu">Login</span></a>
                      </li>
                    </div>
                  <% } %>
              </ul>
            </nav>
          </div>
        </aside>
        <div class="page-wrapper">
          <div class="page-breadcrumb">
            <div class="row">
              <div class="col-12 d-flex no-block align-items-center">
                <h4 class="page-title">Files</h4>
                <div class="ms-auto text-end">
                  <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                      <li class="breadcrumb-item"><a href="/teacher/dashboard">Home</a></li>
                      <li class="breadcrumb-item active" aria-current="page">Files</li>
                    </ol>
                  </nav>
                </div>
              </div>
            </div>
          </div>

          <div class="container-fluid">
            <div class="row ">
                <div class="col-12">
                    <div class="card">
                        <div class="card-body">
                            

                          
                          <div class="container">
                            <div class="row">
                                <div class="col-md-6 offset-md-3">
                                    <h1 class="text-center">Upload a File</h1>
                                    <form action="/file_uploads" method="POST" enctype="multipart/form-data">
                                        <div class="form-group">
                                            <label for="file">Choose File:</label>
                                            <input type="file" class="form-control-file" id="file" name="file" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="name_of_file">Name of File:</label>
                                            <input type="text" class="form-control" id="name_of_file" name="name_of_file" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="sectionname">Select Section:</label>
                                            <select class="form-control" id="sectionname" name="sectionname" required>
                                                <% sections.forEach(section => { %>
                                                <option value="<%= section.sectionname %>"><%= section.sectionname %></option>
                                                <% }); %>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="visibility">Visibility:</label>
                                            <select class="form-control" id="visibility" name="visibility" required>
                                                <option value="visible">Visible</option>
                                                <option value="invisible">Invisible</option>
                                            </select>
                                        </div>
                                        <button type="submit" class="btn btn-primary btn-block">Upload</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
    
    

            <hr>


    <div class="table-responsive">
      <table id="zero_config1" class="table table-striped table-bordered">
        <thead>
            <tr>

                <th>Saved File</th>
                <th>Section</th>
                <th>Teacher ID</th>
                <th>Name of file</th>
                <th>Visibility</th>
                <th>Preview</th>
                <th>Download</th>
                <th>Edit</th>
                <th>Delete</th>
            </tr>
        </thead>
        <tbody>
            <% files.forEach(file => { %>
            <tr>
                <td><%= file.filename %></td>
                <td><%= file.sectionname %></td>
                <td><%= file.teacherid %></td>
                <td><%= file.name_of_file %></td>
                <td><%= file.visibility %></td>
                <td>
                    <% if (file.mimetype.startsWith('image')) { %>
                        <!-- Display image preview with modal -->
                        <a onclick="showModalImage('<%= file.filename %>')" type="button"
                          class="btn btn-outline-warning"><i class="mdi mdi-eye"></i></a>
                        
                    <% } else if (file.mimetype === 'application/pdf') { %>
                        <!-- Display PDF preview with modal -->
                        <a onclick="showModalPDF('<%= file.filename %>')" type="button"
                          class="btn btn-outline-warning" ><i class="mdi mdi-eye"></i></a>
                    <% } else { %>
                        <!-- Display a message for other file types -->
                        File preview not available
                    <% } %>
                    
                    <!-- Modal -->
                    <div id="myModal" class="modal">
                        <div class="modal-content">
                            <span class="close" onclick="closeModal()">&times;</span>
                            <div id="previewContent"></div>
                        </div>
                    </div>
                </td>
                <td><a href="/download/<%= file.filename %>" type="button"
                  class="btn btn-outline-info"><i class="mdi mdi-download"></i></a></td>
                <!-- Button to Open Edit Modal -->
                <!-- <td>
                    <button class="btn btn-outline-warning" data-bs-toggle="modal"
                      data-bs-target="#editGradeModal<%= file.id %>">
                      <i class="mdi mdi-pencil"></i>
                    </button>
                  </td> -->
                  <!-- Trigger/Open The Modal -->
                  <td><a id="myBtn<%= file.id %>" type="button" class="btn btn-outline-success"><i class="mdi mdi-pencil"></i></a></td>

                <!-- The Modal -->
                <div id="myModal<%= file.id %>" class="modal">
                  <!-- Modal content -->
                  <div class="modal-dialog modal-dialog-centered">
                      <div class="modal-content">
                          <div class="modal-header">
                              <h5 class="modal-title">Edit File</h5>
                              <button type="button" class="close" data-dismiss="modal">&times;</button>
                          </div>
                          <div class="modal-body">
                              <form action="/edit/<%= file.id %>" method="POST">
                                  <div class="form-group">
                                      <label for="filename" id="modalfilename">File:</label>
                                      <input type="text" class="form-control" id="filename" name="filename" value="<%= file.filename %>" readonly>
                                  </div>
                                  <div class="form-group">
                                      <label for="sectionname">Section name:</label>
                                      <select id="sectionname" name="sectionname" class="form-control" required>
                                          <option value="<%= file.sectionname %>"><%= file.sectionname %></option>
                                          <% sections.forEach(section => { %>
                                          <option value="<%= section.sectionname %>"><%= section.sectionname %></option>
                                          <% }); %>
                                      </select>
                                  </div>
                                  <div class="form-group">
                                      <label for="name_of_file">Name of File:</label>
                                      <input type="text" class="form-control" id="name_of_file" name="name_of_file" value="<%= file.name_of_file %>">
                                  </div>
                                  <div class="form-group">
                                      <label for="visibility">Visibility:</label>
                                      <select name="visibility" id="visibility" class="form-control" required>
                                          <option value="<%= file.visibility %>"><%= file.visibility %></option>
                                          <option value="visible">Visible</option>
                                          <option value="invisible">Invisible</option>
                                      </select>
                                  </div>
                                  <button type="submit" class="btn btn-primary">Upload</button>
                              </form>
                          </div>
                      </div>
                  </div>
              </div>
              

                

                <td><form action="/delete/<%= file.id %>" method="POST">
                    <a type="submit" type="button" class="btn btn-outline-danger">Delete</a>
                </form></td>
                
            </tr>
                            
            <% }); %>

              
        </tbody>
    </table>
    </div>

    
    <% files.forEach(file => { %>
        <script>
            // Get the modal
            var modal<%= file.id %> = document.getElementById("myModal<%= file.id %>");
            
            // Get the button that opens the modal
            var btn<%= file.id %> = document.getElementById("myBtn<%= file.id %>");
            
            // Get the <span> element that closes the modal
            var span<%= file.id %> = modal<%= file.id %>.getElementsByClassName("close")[0];
            
            // When the user clicks the button, open the modal 
            btn<%= file.id %>.onclick = function() {
              modal<%= file.id %>.style.display = "block";
            }
            
            // When the user clicks on <span> (x), close the modal
            span<%= file.id %>.onclick = function() {
              modal<%= file.id %>.style.display = "none";
            }
            
            // When the user clicks anywhere outside of the modal, close it
            window.onclick = function(event) {
              if (event.target == modal<%= file.id %>) {
                modal<%= file.id %>.style.display = "none";
              }
            }

            // When the user clicks anywhere outside of the modal, close it
        window.addEventListener('click', function(event) {
            if (event.target == modal<%= file.id %>) {
                modal<%= file.id %>.style.display = "none";
            }
        });
        </script>
    <% }); %>
        <!-- For the preview modal -->
    <script>
        function showModalImage(filename) {
            var modal = document.getElementById('myModal');
            var previewContent = document.getElementById('previewContent');
            previewContent.innerHTML = `<img src="${filename}" style="max-width: 100%; max-height: 100%;">`;
            modal.style.display = "block";
        }
    
        function showModalPDF(filename) {
            var modal = document.getElementById('myModal');
            var previewContent = document.getElementById('previewContent');
            previewContent.innerHTML = `<iframe src="${filename}" style="width: 100%; height: 700px; border: none;"></iframe>`;
            modal.style.display = "block";
        }
    
        function closeModal() {
            var modal = document.getElementById('myModal');
            modal.style.display = "none";
            var previewContent = document.getElementById('previewContent');
            previewContent.innerHTML = ""; // Clear the content
        }
    
        // Close the modal when clicking outside of it
        window.onclick = function(event) {
            var modal = document.getElementById('myModal');
            if (event.target == modal) {
                modal.style.display = "none";
                var previewContent = document.getElementById('previewContent');
                previewContent.innerHTML = ""; // Clear the content
            }
        }
    </script>
    
</div>
</div>
</div>

</div>
</div>
    
    
</body>

<script>
    const storage = multer.diskStorage({
    destination: function (req, file, cb) {
        cb(null, 'C:/Users/justr/Downloads/uploadfile/uploads'); // Specify the absolute path to the uploads directory
    },
    filename: function (req, file, cb) {
        cb(null, Date.now() + '-' + file.originalname);
    }
});

</script>
<!-- jQuery (required for Bootstrap JS) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="/assets/libs/jquery/dist/jquery.min.js"></script>
<script src="/assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
<script src="/assets/libs/perfect-scrollbar/dist/perfect-scrollbar.jquery.min.js"></script>
<script src="/assets/extra-libs/sparkline/sparkline.js"></script>
<script src="/dist/js/waves.js"></script>
<script src="/dist/js/sidebarmenu.js"></script>
<script src="/dist/js/custom.min.js"></script>
<script src="/assets/libs/flot/excanvas.js"></script>
<script src="/assets/libs/flot/jquery.flot.js"></script>
<script src="/assets/libs/flot/jquery.flot.pie.js"></script>
<script src="/assets/libs/flot/jquery.flot.time.js"></script>
<script src="/assets/libs/flot/jquery.flot.stack.js"></script>
<script src="/assets/libs/flot/jquery.flot.crosshair.js"></script>
<script src="/assets/libs/flot.tooltip/js/jquery.flot.tooltip.min.js"></script>
<script src="/assets/extra-libs/DataTables/datatables.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/assets/extra-libs/DataTables/datatables.min.js"></script>
<script>

  $("#zero_config1").DataTable();
</script>

<% } else { %>
    <div class="error-box">
      <div class="error-body text-center">
        <h1 class="error-title text-info">403</h1>
        <h3 class="text-uppercase error-subtitle">ACCESS FORBIDDEN !</h3>
        <p class="text-muted mt-4 mb-4">
          YOU SEEM TO BE TRYING TO FIND HIS WAY HOME
        </p>
        <a href="/" class="
      btn btn-info btn-rounded
      waves-effect waves-light
      mb-5
      text-white
    ">Back to home</a>
      </div>
    </div>
    <% } %>

</html>