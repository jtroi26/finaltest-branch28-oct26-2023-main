<!DOCTYPE html>
<html dir="ltr" lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Student-Lessons | DAZSMA </title>
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/dazsma-logo.ico" />
    <link href="/assets/libs/flot/css/float-chart.css" rel="stylesheet" />
    <link href="/dist/css/style.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
         /* Button used to open the contact form - fixed at the bottom of the page */
         .open-button {
        /* background-color: #7895CB; */
        color: white;
        /* padding: 16px 20px; */
        border: none;
        cursor: pointer;
        opacity: 0.8;
        position: fixed;
        bottom: 23px;
        right: 28px;
        width: 280px;
        /* box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2); */
        }

        /* The popup form - hidden by default */
        .form-popup {
        background-color: #ffffff;
        display: none;
        position: fixed;
        bottom: 0;
        right: 15px;
        border: 3px solid #f1f1f1;
        z-index: 9;
        border-radius: 20px;
        box-shadow: 0 4px 20px 0 rgba(4, 42, 148, 0.733);
        margin-right: 5px;
        margin-bottom: 5px;
        
        }

        .form-container {
            margin-left: 30px;
            margin-right: 30px;
            margin-bottom: 5px;
            max-width: 100%;
            padding: 10px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2); /* Thicker outer shadow */
        }



        /* Full-width input fields */
        .form-container input[type=text], .form-container input[type=password] {
        width: 100%;
        padding: 15px;
        margin: 5px 0 22px 0;
        border: none;
        background: #f1f1f1;
        }

        /* When the inputs get focus, do something */
        .form-container input[type=text]:focus, .form-container input[type=password]:focus {
        background-color: #ddd;
        outline: none;
        }

        /* Set a style for the submit/login button */
        .form-container .btn {
        background-color: #0380c3;
        color: white;
        padding: 10px 10px;
        border: none;
        cursor: pointer;
        width: 100%;
        margin-bottom:10px;
        opacity: 0.8;
        }

        /* Add a red background color to the cancel button */
        .form-container .cancel {
        background-color: red;
        }

        /* Add some hover effects to buttons */
        .form-container .btn:hover, .open-button:hover {
        opacity: 1;
        }

        .chat-container {
            max-width: 80%;
            margin: auto;
            overflow-y: auto;
            max-height: 300px; /* Adjust the height or remove for unlimited scroll */
        }

                /* For the AI */


                .chat-box {
            height: 320px;
            border-bottom: 1px solid #ccc;
            margin-bottom: 10px;
            padding-bottom: 10px;
            background-color: #e9e9e9;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(6, 197, 255, 0.1); /* Add an outer shadow */
        }


        .user-message {
            background-color: #e6f7ff;
            width: 50%;
            float: right;
            clear: both;
            margin-bottom: 10px;
            border-radius: 10px;
            font-size: 20px;
            margin-top: 10px;
            margin-right: 10px;
            box-shadow: 0 4px 8px 0 rgba(4, 42, 148, 0.733);
            
        }

        .bot-message {
            background-color: #d9f5d9;
            width: 50%;
            float: left;
            clear: both;
            margin-bottom: 10px;
            border-radius: 10px;
            font-size: 20px;
            margin-left: 10px;
            margin-top: 10px;
            box-shadow: 0 4px 8px 0 rgba(4, 148, 16, 0.733);
            
        }

        .message {
            padding: 8px;
            border-radius: 5px;
            word-wrap: break-word; /* To wrap long messages */
        }



/* For the text to speech */
.container {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 50%;
    padding: 1px;
    border: 1px solid #ccc;
    border-radius: 10px; /* Add border radius for rounded corners */
    background-color: #0380c3;
}


.button-container {
    display: flex;
    gap: 5px; /* Adjust the gap between buttons */
}

#voiceSelect {
    flex: 1; /* Allows the select element to grow and fill available space */
    margin-left: 10px; /* Adjust the margin between buttons and select */
    opacity: 70%;
    margin-top: 10px;
    margin-right: 5px;
}
    
    /* For the highlited text */
    #highlightButton {
            display: none;
            position: absolute;
            background-color: #000000;
            color: white;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            /* To adjust the button position */
            margin-top: -60px;
            margin-left: -250px;
            box-shadow: 0 4px 8px 0 rgba(4, 148, 16, 0.733);
        }

        #highlightedText {
            position: relative;
        }


    </style>

</head>
<% if (studentid) { %> 

    <body>
        <div class="preloader">
            <div class="lds-ripple">
                <div class="lds-pos"></div>
                <div class="lds-pos"></div>
            </div>
        </div>
        <div id="main-wrapper" data-layout="vertical" data-navbarbg="skin5" data-sidebartype="full"
            data-sidebar-position="absolute" data-header-position="absolute" data-boxed-layout="full">
            <header class="topbar" data-navbarbg="skin5">
                <nav class="navbar top-navbar navbar-expand-md navbar-dark">
                    <div class="navbar-header" data-logobg="skin5">
                        <a class="navbar-brand" href="/student/dashboard">
                            <b class="logo-icon ps-2">
                                <img src="/assets/images/dazsma-logo.png" alt="homepage" class="light-logo"
                                    width="25" />
                            </b>
                            <span class="logo-text ms-2">
                                <span>DAZSMA</span>
                            </span>
                        </a>
                        <a class="nav-toggler waves-effect waves-dark d-block d-md-none" href="javascript:void(0)"><i
                                class="ti-menu ti-close"></i></a>
                    </div>
                    <div class="navbar-collapse collapse" id="navbarSupportedContent" data-navbarbg="skin5">
                        <ul class="navbar-nav float-start me-auto">
                            <li class="nav-item d-none d-lg-block">
                                <a class="nav-link sidebartoggler waves-effect waves-light" href="javascript:void(0)"
                                    data-sidebartype="mini-sidebar"><i class="mdi mdi-menu font-24"></i></a>
                            </li>
                        </ul>
                    </div>
                </nav>
            </header>
            <aside class="left-sidebar" data-sidebarbg="skin5">
                <div class="scroll-sidebar">
                    <nav class="sidebar-nav">
                        <ul id="sidebarnav" class="pt-4">
                            <li class="sidebar-item">
                                <a class="sidebar-link waves-effect waves-dark sidebar-link" href="/student/dashboard"
                                    aria-expanded="false"><i class="mdi mdi-view-dashboard"></i><span
                                        class="hide-menu">Dashboard</span></a>
                            </li>

                            <li class="sidebar-item">
                                <a class="sidebar-link waves-effect waves-dark sidebar-link"
                                    href="/student/view/classmates" aria-expanded="false"><i
                                        class="mdi mdi-account-multiple"></i><span
                                        class="hide-menu">Classmates</span></a>
                            </li>
                            <li class="sidebar-item">
                                <a class="sidebar-link waves-effect waves-dark sidebar-link"
                                    href="/student/view/announcement" aria-expanded="false"><i
                                        class="mdi mdi-bullhorn"></i><span class="hide-menu">Announcements</span></a>
                            </li>
                            <li class="sidebar-item">
                                <a class="sidebar-link waves-effect waves-dark sidebar-link"
                                    href="/student/view/lessons" style="margin-bottom: 408px;" aria-expanded="false"><i
                                        class="mdi mdi-book-multiple"></i><span class="hide-menu">Lessons</span></a>
                            </li>
                            <% if (studentid) { %>
                                <form id="logoutForm" action="/logout" method="post">
                                    <li class="sidebar-item">
                                        <a href="javascript:void(0);"
                                            class="sidebar-link waves-effect waves-dark sidebar-link"
                                            onclick="document.getElementById('logoutForm').submit();"
                                            aria-expanded="false"><i class="mdi mdi-logout"></i><span
                                                class="hide-menu">Logout</span></a>
                                    </li>
                                </form>
                                <% } else { %>
                                    <li class="sidebar-item">
                                        <a href="/" class="sidebar-link waves-effect waves-dark sidebar-link"
                                            style="margin-top: auto;" aria-expanded="false"><i
                                                class="mdi mdi-login"></i><span class="hide-menu">Login</span></a>
                                    </li>
                                    <% } %>
                        </ul>
                    </nav>
                </div>
            </aside>
            <div class="page-wrapper">
                <div class="page-breadcrumb">
                    <div class="row">
                        <div class="col-12 d-flex no-block align-items-center">
                            <h4 class="page-title">Lesson > <%= lessonData.lessonTitle %>
                            </h4>
                            <div class="ms-auto text-end">
                                <nav aria-label="breadcrumb">
                                    <ol class="breadcrumb">
                                        <li class="breadcrumb-item"><a href="/student/dashboard">Home</a></li>
                                        <li class="breadcrumb-item"><a href="/student/view/lessons">Lessons</a></li>
                                        <li class="breadcrumb-item active" aria-current="page">Lesson</li>
                                    </ol>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="container-fluid">
                    <div class="row ">
                        <div class="col-12">
                            <div class="card">
                                <div id="highlightedText" onmouseup="showButton()">
                                    <% for (let i=1; i <=10; i++) { %>
                                        <div class="card-body">

                                            <div id="announcementDiv<%= i %>">
                                                <p>
                                                    <%- lessonData['section' + i] %>
                                                </p>
                                            </div>
                                            
                                            <button id="highlightButton" onclick="copyHighlightedText()">Send to Trivia</button>
                                            <% if (lessonData['section' + i]) { %>
                                                
                                                <div class="container">
                                                    <div class="button-container">
                                                        <button type="button" class="btn fa-solid fa-play fa-2x" onclick="speakText('announcementDiv<%= i %>')"></button>
                                                        <button type="button" class="btn fa-solid fa-stop fa-2x" onclick="stopSpeech()"></button>
                                                        <button type="button" class="btn fa-solid fa-pause fa-2x" onclick="pauseSpeech()"></button>
                                                        <button type="button" class="btn fa-regular fa-circle-play fa-2x" onclick="resumeSpeech()"></button>
                                                    </div>
                                                    <select class="form-select form-select-lg mb-3" id="voiceSelect">
                                                        <!-- Options will be populated dynamically via JavaScript -->
                                                    </select>
                                                </div>    
                                                    </select>
                                                    
                                                    <hr>
                                                
                                            <% } %>
                                            <img src="/Images/button_for_chat1.png" class="open-button" onclick="openForm()" style="width: 80px; cursor: pointer;" alt="Generate A Trivia">

                                            <!-- Chatgpt -->
                                            <div class="form-popup" id="myForm" style="display: none; width: 35%;" >
                                                <h1 class="fa-solid fa-lightbulb" style="margin-left: 20px; margin-top: 10px; color: #5794ff;"> Trivia</h1>
                                                <hr>
                                                <div class="message">
                                                    <div class="chat-box" id="chat-box"></div>
                                                    
                                                </div>
                                                

                                                  <div id="messageForm" class="form-container">
                                                    <input type="text" id="userInput" name="userInput" placeholder="Type a message..." value="Magbigay ng Trivia patungkol sa <%= lessonData.lessonTitle %>" hidden>
                                                    <input type="text" id="highlight_input" name="highlight_input" placeholder="Your Highlighted Text here..." readonly style="text-align: center;">
                                                    <button type="button" class="btn btn-primary" onclick="sendhighlightedMessage()">Trivia about highlighted text</button>
                                                    <button type="button" class="btn btn-info" onclick="sendMessage()">Generate Trivia about the Topic</button>
                                                    <button type="button" class="btn cancel" onclick="closeForm()">Close</button>
                                                  </div>

                                            </div>
                                            

                                            <script>
                                                let synth = window.speechSynthesis;
                                                let currentlySpeaking = null;

                                                let speech = new SpeechSynthesisUtterance();
                                                let voices = [];
                                                let voicesSelect = document.querySelector('#voiceSelect'); // Target by ID

                                                window.speechSynthesis.onvoiceschanged = () => {
                                                voices = window.speechSynthesis.getVoices();
                                                speech.voice = voices[121];

                                                voices.forEach((voice, i) => (voicesSelect.options[i] = new Option(voice.name, i)));
};
//      Filter voices for indices 120 and 121 (voices 121 and 122)
//     let filteredVoices = voices.filter((voice, i) => i === 121 || i === 122);

//      Create options for the select element using filtered voices
//     filteredVoices.forEach((voice, i) => {
//         let voiceIndex = i + 122; // Start numbering from 121
//         let voiceName = (voiceIndex === 122) ? 'Angelo' : 'Blessica'; // Assign custom names based on voice index
//         voicesSelect.options[i] = new Option(`${voiceName}`, i + 121);
//     });
// };


                                                voicesSelect.addEventListener("change", () => {
                                                    speech.voice = voices[voicesSelect.value];
                                                });

                                                function speakText(divId) {
                                                    if (currentlySpeaking) {
                                                        currentlySpeaking.pause();
                                                        currentlySpeaking = null;
                                                    }

                                                    let text = document.getElementById(divId).innerText;
                                                    let utterance = new SpeechSynthesisUtterance(text);
                                                    utterance.voice = speech.voice; // Set the selected voice
                                                    synth.speak(utterance);
                                                    currentlySpeaking = utterance;
                                                }
                                                                                        
                                                function pauseSpeech() {
                                                    if (currentlySpeaking) {
                                                        synth.pause();
                                                    }
                                                }
                                            
                                                function resumeSpeech() {
                                                    if (currentlySpeaking) {
                                                        synth.resume();
                                                    }
                                                }

                                                function stopSpeech() {
                                                    if (currentlySpeaking) {
                                                        synth.cancel();
                                                        currentlySpeaking = null;
                                                    }
                                                }
                                            </script>


                                        </div>
                                        <!-- <hr> -->
                                        <% } %>
                                    
                                </div>
                            </div>
                        </div>

                    </div>
                    
                </div>
            </div>
        </div>

        <!-- for the highlighted text -->
        <script>
            function showButton() {
                var selectedText = getSelectedText();
                var highlightButton = document.getElementById('highlightButton');
        
                if (selectedText !== '') {
                    highlightButton.style.display = 'block';
                    positionButton();
                } else {
                    highlightButton.style.display = 'none';
                }
            }
        
            function getSelectedText() {
                
                var selectedText = '';
                if (window.getSelection) {
                    selectedText = window.getSelection().toString();
                } else if (document.selection && document.selection.type !== 'Control') {
                    selectedText = document.selection.createRange().text;
                }
                return selectedText;
            }
        
            function positionButton() {
                var highlightButton = document.getElementById('highlightButton');
                var selectedText = getSelectedText();
                var selection = window.getSelection();
                var range = selection.getRangeAt(0);
                var rect = range.getBoundingClientRect();
        
                var top = rect.top + window.scrollY - highlightButton.clientHeight - 5;
                var left = rect.left + window.scrollX + rect.width / 2 - highlightButton.clientWidth / 2;
        
                highlightButton.style.top = top + 'px';
                highlightButton.style.left = left + 'px';
            }
        
            function copyHighlightedText() {
                var selectedText = getSelectedText();
                var highlightInput = document.getElementById('highlight_input');
                highlightInput.value = selectedText;
                document.getElementById("myForm").style.display = "block";
                // You can add additional actions here if needed
            }
        </script>

        <!-- End of highlighted text -->

        <script>
            function openForm() {
              document.getElementById("myForm").style.display = "block";
            }
            
            function closeForm() {
              document.getElementById("myForm").style.display = "none";
            }
        
            
            </script>
        
        <script>
            function sendMessage() {
              var userInput = document.getElementById("userInput");
              var message = userInput.value;
          
              if (message.trim() !== "") {
                displayMessage(message, true);
                userInput.value = "";
          
                // Send the message to the server-side
                fetch('/student/view/lesson/<%= lessonData.id %>', { // Replace with your server endpoint
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json',
                  },
                  body: JSON.stringify({ userInput: message }),
                })
                  .then(response => response.json())
                  .then(data => {
                    displayMessage(data.response, false);
                  })
                  .catch(error => {
                    console.error('Error:', error);
                  });
          
                generateTrivia(); // Call the function to generate trivia after sending the message
              }
            }
          
            function generateTrivia() {
              const trivia = [
                "Magbigay pa ng trivia patungkol sa <%= lessonData.lessonTitle %> ",
                "Magbigay pa ng karagdagang trivia patungkol sa <%= lessonData.lessonTitle %> ",
                "Trivia patungkol sa <%= lessonData.lessonTitle %> "
              ];
          
              const randomIndex = Math.floor(Math.random() * trivia.length);
              const randomTrivia = trivia[randomIndex];
          
              document.getElementById('userInput').value = randomTrivia;
            }
          
            function displayMessage(message, isUser) {
              var chatBox = document.getElementById("chat-box");
              var messageDiv = document.createElement("div");
              messageDiv.classList.add(isUser ? "user-message" : "bot-message");
              messageDiv.innerHTML = message;
              chatBox.appendChild(messageDiv);
          
              // Scroll to the bottom of chat box
              chatBox.scrollTop = chatBox.scrollHeight;
            }
          </script>

<script>
    function sendhighlightedMessage() {
    
      var userInput = document.getElementById("highlight_input");
      var message = userInput.value;
  
      if (message.trim() !== "") {
        // Add additional text before the user input
        var additionalText = "Magbigay ng Trivia patungkol sa ";
        var fullMessage = additionalText + message;

        displayMessage(fullMessage, true);
        userInput.value = "";
  
        // Send the message to the server-side
        fetch('/student/view/lesson/<%= lessonData.id %>', { // Replace with your server endpoint
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ userInput: message }),
        })
          .then(response => response.json())
          .then(data => {
            displayMessage(data.response, false);
          })
          .catch(error => {
            console.error('Error:', error);
          });
      }
    }
  
    function displayMessage(message, isUser) {
      var chatBox = document.getElementById("chat-box");
      var messageDiv = document.createElement("div");
      messageDiv.classList.add(isUser ? "user-message" : "bot-message");
      messageDiv.innerHTML = message;
      chatBox.appendChild(messageDiv);
  
      // Scroll to the bottom of chat box
      chatBox.scrollTop = chatBox.scrollHeight;
    }
</script>





        <script src="/assets/libs/jquery/dist/jquery.min.js"></script>
        <script src="/assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
        <script src="/assets/libs/perfect-scrollbar/dist/perfect-scrollbar.jquery.min.js"></script>
        <script src="/assets/extra-libs/sparkline/sparkline.js"></script>
        <script src="/dist/js/waves.js"></script>
        <script src="/dist/js/sidebarmenu.js"></script>
        <script src="/dist/js/custom.min.js"></script>
        <script src="/assets/libs/flot/excanvas.js"></script>
        <script src="/assets/libs/flot/jquery.flot.js"></script>
        <script src="/assets/libs/flot/jquery.flot.pie.js"></script>
        <script src="/assets/libs/flot/jquery.flot.time.js"></script>
        <script src="/assets/libs/flot/jquery.flot.stack.js"></script>
        <script src="/assets/libs/flot/jquery.flot.crosshair.js"></script>
        <script src="/assets/libs/flot.tooltip/js/jquery.flot.tooltip.min.js"></script>
        <script src="/dist/js/pages/chart/chart-page-init.js"></script>
    </body>
    <% } else { %>
        <div class="error-box">
          <div class="error-body text-center">
            <h1 class="error-title text-info">403</h1>
            <h3 class="text-uppercase error-subtitle">ACCESS FORBIDDEN !</h3>
            <p class="text-muted mt-4 mb-4">
              YOU SEEM TO BE TRYING TO FIND HIS WAY HOME
            </p>
            <a href="/" class="
          btn btn-info btn-rounded
          waves-effect waves-light
          mb-5
          text-white
        ">Back to home</a>
          </div>
        </div>
        <% } %>

</html>